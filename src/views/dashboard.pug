include ../mixins/header
include ../mixins/head
include ../utils

doctype html
html
  +head("dashboard")
  body(data-theme=user.themePreference data-classic-layout=user.useClassicLayout)
    main#content
      +header(user)
      div.hero
        h1 dashboard

        if message
          div.dashboard-error-message
            | #{message}

        h2 preferences
        form(action="/update-preferences" method="POST" autocomplete="off")
          div
            label(for="pref-infinite-scroll")
              input(type="checkbox" id="pref-infinite-scroll" name="infiniteScroll" value="1" checked=(user.infiniteScroll === 1))
              | &nbsp;Enable Never Ending Reddit (infinite scroll)

          div(style="margin-top: 15px;")
            label(for="pref-classic-layout")
              input(type="checkbox" id="pref-classic-layout" name="useClassicLayout" value="1" checked=(user.useClassicLayout === 1))
              | &nbsp;Use Classic RES-style Layout (desktop)

          div(style="margin-top: 15px;")
            label(for="pref-high-res-thumbnails")
              input(type="checkbox" id="pref-high-res-thumbnails" name="highResThumbnails" value="1" checked=(user.highResThumbnails === 1))
              | &nbsp;Use High Resolution Thumbnails (disable for low bandwidth)

          div(style="margin-top: 15px;")
            label(for="pref-theme" style="display: block; margin-bottom: 5px;") Theme Preference:
            select(id="pref-theme" name="themePreference" style="padding: 5px; background-color: var(--bg-color-muted); color: var(--text-color); border: 1px solid var(--text-color-muted); border-radius: 4px;")
              option(value="auto" selected=(user.themePreference === 'auto')) Auto (system preference)
              option(value="light" selected=(user.themePreference === 'light')) Light
              option(value="dark" selected=(user.themePreference === 'dark')) Dark
              option(value="res" selected=(user.themePreference === 'res')) RES Night Mode

          button(type="submit" style="margin-top: 20px;") Save Preferences

        if isAdmin
          h2 invites

          if invites
            table.invite-table
              tr
                th.invite-table-header link
                th.invite-table-header created
                th.invite-table-header claimed
                th.invite-table-header delete
              each invite in invites
                tr
                  td.invite-link
                    a(href=`/register?token=${invite.token}`) #{invite.token} 
                  td #{timeDifference(Date.now(), invite.createdAt)} ago
                  if invite.usedAt
                    td #{timeDifference(Date.now(), invite.usedAt)} ago
                  else
                    td unclaimed
                  td 
                    a(href=`/delete-invite/${invite.id}`) delete

          a(href="/create-invite") create invite

        else
          p you aren't an admin and therefore there is nothing to see here yet
 
